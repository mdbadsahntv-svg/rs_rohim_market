<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rs Rohim Smart Market</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    min-height:100vh;
    color:#fff;
}
.box{
    width:100%;
    max-width:400px;
    background:rgba(255,255,255,0.1);
    padding:20px;
    border-radius:15px;
    margin:15px auto;
    box-shadow:0 0 15px rgba(0,0,0,0.4);
}
h2{text-align:center;margin-bottom:15px;}
input, button{
    width:100%;
    padding:12px;
    margin:8px 0;
    border:none;
    border-radius:8px;
    font-size:15px;
}
button{
    background:#00ffcc;
    font-weight:bold;
    cursor:pointer;
}
button:hover{opacity:.8}
.link{text-align:center;margin-top:10px;cursor:pointer;color:#00ffcc;}
img{width:60px;height:60px;border-radius:10px;object-fit:cover;}
.card{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.1);padding:10px;margin-bottom:10px;border-radius:10px;}
.card img{margin-right:10px;width:50px;height:50px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h2>Login</h2>
<input id="loginEmail" type="email" placeholder="Email">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<div class="link" onclick="showRegister()">Create Account</div>
</div>

<!-- REGISTER -->
<div class="box" id="registerBox" style="display:none">
<h2>Register</h2>
<input id="name" placeholder="Your Name">
<input id="shop" placeholder="Shop Name">
<input id="phone" placeholder="Phone Number">
<input id="email" type="email" placeholder="Email">
<input id="pass" type="password" placeholder="Password">
<input type="file" id="photo">
<button onclick="register()">Register</button>
<div class="link" onclick="showLogin()">Already have account?</div>
</div>

<!-- DASHBOARD -->
<div class="box" id="dashboard" style="display:none">
<h2>Seller Dashboard</h2>
<img id="userPic">
<p id="userInfo"></p>

<!-- Product Upload -->
<h3>Upload Product</h3>
<input id="productName" placeholder="Product Name">
<input id="productPrice" placeholder="Price">
<input type="file" id="productImage">
<button onclick="uploadProduct()">Add Product</button>

<h3>Live Market</h3>
<div id="market"></div>

<button onclick="logout()">Logout</button>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// UI Switch
function showRegister(){loginBox.style.display='none'; registerBox.style.display='block';}
function showLogin(){registerBox.style.display='none'; loginBox.style.display='block';}

// REGISTER
async function register(){
  let nameVal=name.value;
  let shopVal=shop.value;
  let phoneVal=phone.value;
  let emailVal=email.value;
  let passVal=pass.value;
  let file=photo.files[0];
  if(!file){alert("Upload Photo"); return;}
  try{
    const user = await auth.createUserWithEmailAndPassword(emailVal, passVal);
    const ref = storage.ref('shops/'+user.user.uid);
    await ref.put(file);
    const imgURL = await ref.getDownloadURL();
    await db.collection('users').doc(user.user.uid).set({
      name:nameVal,
      shop:shopVal,
      phone:phoneVal,
      email:emailVal,
      photo:imgURL
    });
    alert("Account Created ‚úÖ");
    showLogin();
  }catch(e){alert(e.message);}
}

// LOGIN
async function login(){
  try{await auth.signInWithEmailAndPassword(loginEmail.value,loginPass.value);}
  catch(e){alert(e.message);}
}

// AUTH STATE
auth.onAuthStateChanged(async user=>{
  if(user){
    loginBox.style.display='none';
    registerBox.style.display='none';
    dashboard.style.display='block';
    let doc = await db.collection('users').doc(user.uid).get();
    let data = doc.data();
    userPic.src = data.photo;
    userInfo.innerHTML = `üë§ ${data.name}<br>üè™ ${data.shop}<br>üìû ${data.phone}`;
    loadProducts();
  }
});

// LOGOUT
function logout(){auth.signOut(); location.reload();}

// UPLOAD PRODUCT
async function uploadProduct(){
  let nameVal = productName.value;
  let priceVal = productPrice.value;
  let file = productImage.files[0];
  if(!nameVal || !priceVal || !file){alert("Fill all fields"); return;}
  const user = auth.currentUser;
  const ref = storage.ref('products/'+user.uid+'/'+file.name);
  await ref.put(file);
  const url = await ref.getDownloadURL();
  await db.collection('products').add({
    name:nameVal,
    price:priceVal,
    image:url,
    sellerId:user.uid,
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });
  alert("Product Added ‚úÖ");
  productName.value=''; productPrice.value=''; productImage.value=null;
}

// LOAD PRODUCTS (Live Market)
function loadProducts(){
  db.collection('products').orderBy('timestamp','desc')
    .onSnapshot(snapshot=>{
      const market = document.getElementById('market');
      market.innerHTML='';
      snapshot.docs.forEach(doc=>{
        const data = doc.data();
        market.innerHTML += `
          <div class="card">
            <div style="display:flex;align-items:center;">
              <img src="${data.image}">
              <div>
                <h3>${data.name}</h3>
                <p>‡ß≥ ${data.price}</p>
              </div>
            </div>
          </div>
        `;
      });
    });
}
</script>
</body>
</html>rc=data.photo;
   userInfo.innerHTML=`üë§ ${data.name}<br>üè™ ${data.shop}<br>üìû ${data.phone}`;
   loadMarket();
 }
});

/* Logout */
function logout(){ auth.signOut(); location.reload(); }

/* Add Product */
function showAddProduct(){dashboard.style.display='none';addProductBox.style.display='block';}
function hideAddProduct(){addProductBox.style.display='none';dashboard.style.display='block';}
async function addProduct(){
 let name=productName.value, price=productPrice.value, file=productPhoto.files[0];
 if(!name || !price || !file){alert("Fill All Fields & Upload Photo");return;}
 const ref=storage.ref('products/'+currentUser.uid+'/'+file.name);
 await ref.put(file); const imgURL=await ref.getDownloadURL();
 await db.collection('products').add({uid:currentUser.uid,name:name,price:Number(price),photo:imgURL,shop:currentUser.uid});
 alert("Product Added ‚úÖ"); productName.value=''; productPrice.value=''; productPhoto.value=''; loadMarket();
 hideAddProduct();
}

/* Edit Product */
let editId=null;
function showEditProduct(item){
 editProductBox.style.display='block'; addProductBox.style.display='none'; dashboard.style.display='none';
 editId=item.id; editProductName.value=item.name; editProductPrice.value=item.price;
}
function hideEditProduct(){editProductBox.style.display='none';dashboard.style.display='block';}

/* Update Product */
async function updateProduct(){
 let name=editProductName.value, price=editProductPrice.value, file=editProductPhoto.files[0];
 if(!name || !price){alert("Fill Name & Price");return;}
 let data={name, price:Number(price)};
 if(file){ const ref=storage.ref('products/'+currentUser.uid+'/'+file.name); await ref.put(file); const imgURL=await ref.getDownloadURL(); data.photo=imgURL; }
 await db.collection('products').doc(editId).update(data);
 alert("Product Updated ‚úÖ"); editProductBox.style.display='none'; loadMarket(); dashboard.style.display='block';
}

/* Delete Product */
async function deleteProduct(id){ if(confirm("Are you sure?")){ await db.collection('products').doc(id).delete(); loadMarket(); alert("Product Deleted ‚úÖ"); }}

/* Market Page */
function showMarket(){dashboard.style.display='none';marketPage.style.display='block';}
function hideMarket(){marketPage.style.display='none';dashboard.style.display='block';}
let marketData=[];
async function loadMarket(){
 const snapshot=await db.collection('products').where('uid','==',currentUser.uid).get();
 marketData=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
 renderData(marketData);
}

function renderData(data){
 const market=document.getElementById('market');
 market.innerHTML='';
 data.forEach(item=>{
   const div=document.createElement('div');
   div.className='card';
   div.innerHTML=`
   <div style="display:flex;align-items:center;">
     <img src="${item.photo || ''}">
     <span>${item.name} - ‡ß≥${item.price}/kg</span>
   </div>
   <div>
     <button onclick='showEditProduct(${JSON.stringify(item)})'>Edit</button>
     <button onclick='deleteProduct("${item.id}")'>Delete</button>
   </div>
   `;
   market.appendChild(div);
 });
}

/* LIVE MARKET */
const liveProductsDiv=document.getElementById('liveProducts');
const searchLive=document.getElementById('searchLive');

function showLiveMarket(){loginBox.style.display='none';registerBox.style.display='none';dashboard.style.display='none';marketPage.style.display='none';liveMarket.style.display='block';loadLiveMarket();}
function hideLiveMarket(){liveMarket.style.display='none';loginBox.style.display='block';}
function loadLiveMarket(){
 db.collection('products').onSnapshot(snapshot=>{
   let products=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
   renderLiveProducts(products);
   searchLive.oninput=function(){
     let filtered=products.filter(p=>p.name.toLowerCase().includes(this.value.toLowerCase()));
     renderLiveProducts(filtered);
   };
 });
}

function renderLiveProducts(data){
 liveProductsDiv.innerHTML='';
 data.forEach(item=>{
   const div=document.createElement('div');
   div.className='card';
   liveProductsDiv.appendChild(div);
   div.innerHTML=`
    <div style="display:flex;align-items:center;">
      <img src="${item.photo||''}">
      <div>
        <b>${item.name}</b><br>
        üè™ ${item.shop}<br>
        ‡ß≥ ${item.price}/kg
      </div>
    </div>
   `;
 });
}
</script>
</body>
</html>